{% extends "codemirror.html" %}

{% block title %}
	{{ task_name }}
{% endblock title %}

{% block content %}
<div class="container">
	<div class="row">
		<!-- Main Content Column -->
		<div class="col-md-8">
			<!-- Preformatted markdown for task description -->
			{{ task.description | safe}}

			<!-- Loop for task inputs -->
			{% for i in task.inputs %}
				<h6>Input {{ loop.index }}: {{ i.description }}</h6>
				<div>
					<span>In:</span>  <code>{{ i.data_in }}</code> <br />
				</div>
				<div>
					<span>Out:</span> <code>{{ i.data_out }}</code> <br />
				</div>
			{% endfor %}
			<br />

			<!-- Display task arguments -->
			Your program will be run with the following arguments:
			<code>
				{{ task.arguments }}
			</code>
			<hr />

			<!-- Submission section for logged-in users -->
			{% if 'logged_in' in sessions %}
				<h5><a href="/submit/{{ task.id }}">Submit a solution</a></h5>
				{% if submission_found %}
					<h5>Your latest submission:</h5>
					<div>
						<div>
							Submission result:
							{% if result == -1 %}
								<span style="color: rgb(239, 198, 15);">Pending</span>
							{% elif result == 0 %}
								<span style="color: green;">Accepted</span>
							{% else %}
								<span style="color: red;">Rejected</span>
							{% endif %}
						</div>
						<div>
							Time submitted:
							{{ time }}
						</div>

						{% if result == 0 %}
							<div>
								Score:
								<code>{{ score }}</code>
							</div>
						{% endif %}

						{% if result_file %}
							<div id="resultFileCodeMirror"></div>
						{% endif %}
						
					</div>
				{% endif %}
			{% endif %}
		</div>

		<!-- Scoreboard Column -->
		<div class="col-md-4">
			<div class="card">
				<div class="card-header">
					Top Scores (cycles)
				</div>
				<ul class="list-group list-group-flush scrollable-list">
					{% for userid, score, name in scores %}
						{% if score > 0 %}
							<li class="list-group-item {% if userid == session['user_id'] %}highlight{% endif %}">
								<div class="row">
									<div class="col-sm-8">
										{{ name }}
									</div>
									<div class="col-sm-4 border-left">
										{{ score }}
									</div>
								</div>
							</li>
						{% endif %}
					{% endfor %}
				</ul>
			</div>
		</div>
	</div>
</div>
{% endblock content %}

{% block cmirror %}
	<script>
		var resultFileContent = {{ result_file|tojson }};
		var resultFileEditor = CodeMirror(document.getElementById("resultFileCodeMirror"), {
			lineNumbers: true,
			mode: "python",
			lineWrapping: true,
			viewportMargin: Infinity,
			readOnly: true,
		});

		resultFileEditor.setSize("1250px", "500px");
		resultFileEditor.setValue(resultFileContent);
	</script>
{% endblock %}
