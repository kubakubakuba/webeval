{% extends "base.html" %}

{% block title %}
Task Management - Admin Panel
{% endblock title %}

{% block content %}
	<script src="{{ url_for('static', filename='libs/jquery-3.3.1.min.js') }}"></script>
	<script src="{{ url_for('static', filename='libs/bootstrap.bundle.min.js') }}"></script>
	<script src="{{ url_for('static', filename='libs/jquery.tablednd.min.js') }}"></script>
	<script src="{{ url_for('static', filename='libs/bootstrap-table.min.js') }}"></script>
	<link rel="stylesheet" href="{{ url_for('static', filename='libs/bootstrap-table.min.css') }}">
	<script src="{{ url_for('static', filename='libs/bootstrap-table-reorder-rows.min.js') }}"></script>

	<style>
		.form-select {
			margin: 15px 0px 15px 0px;
		}

		.card-btn {
			margin: 15px 0px 15px 0px;
			cursor: pointer;
		}

		.main-content {
			max-width: 5000px!important;
		}

		table {
			margin: 15px 0px 15px 0px;
		}

		#create-new-task {
			margin-top: 15px;
		}

		#create-new-task::placeholder,
		#rename-task-input::placeholder,
		#change-task-input::placeholder {
			color: #6c757d;
		}

		html.dark-mode #create-new-task::placeholder,
		html.dark-mode #rename-task-input::placeholder,
		html.dark-mode #change-task-input::placeholder {
			color: #adb5bd;
		}

		.back-link {
			display: inline-block;
			margin-bottom: 20px;
			color: var(--link-color);
			text-decoration: none;
		}

		.back-link:hover {
			text-decoration: underline;
		}
	</style>

	<a href="/admin" class="back-link">‚Üê Back to Admin Panel</a>

	<h1 class="mb-4">Task Management</h1>

	<div class="row">
		<!-- Left Column -->
		<div class="col-md-6">
			<h3>Task Operations</h3>

			Rename a task:

			<div class="row">
				<div class="col-md-12">
					<select id="rename-task-selector" class="form-select" aria-label="Rename task selector">
						<option value="-">-</option>
						{% for task in tasks %}
							<option value="{{ task[0] }}">{{ task[1] }}</option>
						{% endfor %}
					</select>

					<input type="text" id="rename-task-input" class="form-control" placeholder="New name" aria-label="New name" style="margin-top: 10px;">
				</div>
			</div>

			<div class="card card-btn" onclick="location.href='/admin/rename/' + document.getElementById('rename-task-selector').value + '/' + document.getElementById('rename-task-input').value;">
				<div class="card-body text-center">
					Rename task
				</div>
			</div>

			<hr />

			Change task path (without tasks/):
			
			<div class="row">
				<div class="col-md-12">
					<select id="change-task-selector" class="form-select" aria-label="Change task selector">
						<option value="-">-</option>
						{% for task in tasks %}
							<option value="{{ task[0] }}">{{ task[1] }}: {{ task[2] }}</option>
						{% endfor %}
					</select>

					<input type="text" id="change-task-input" class="form-control" placeholder="config.toml" aria-label="New path" style="margin-top: 10px;">
				</div>
			</div>

			<div class="card card-btn" onclick="location.href='/admin/repath/' + document.getElementById('change-task-selector').value + '/' + document.getElementById('change-task-input').value;">
				<div class="card-body text-center">
					Change task path
				</div>
			</div>

			<hr />

			Create a new task:

			<div class="row">
				<div class="col-md-12">
					<input type="text" id="create-new-task" class="form-control" placeholder="config.toml" aria-label="New path">
				</div>
			</div>

			<div class="card card-btn" onclick="location.href='/admin/new/' + document.getElementById('create-new-task').value;">
				<div class="card-body text-center">
					Create new task
				</div>
			</div>

			<hr />

			Disable task:

			<div class="row">
				<div class="col-md-12">
					<select id="disable-task-selector" class="form-select" aria-label="Disable task selector">
						<option value="-">-</option>
						{% for task in tasks %}
							{% if task[3] == True %}
								<option value="{{ task[0] }}">{{ task[1] }}</option>
							{% endif %}
						{% endfor %}
					</select>
				</div>
			</div>

			<div class="card card-btn" onclick="location.href='/admin/available/' + document.getElementById('disable-task-selector').value + '/0';">
				<div class="card-body text-center">
					Disable task
				</div>
			</div>

			<hr />

			Enable task:

			<div class="row">
				<div class="col-md-12">
					<select id="enable-task-selector" class="form-select" aria-label="Enable task selector">
						<option value="-">-</option>
						{% for task in tasks %}
							{% if task[3] == False %}
								<option value="{{ task[0] }}">{{ task[1] }}</option>
							{% endif %}
						{% endfor %}
					</select>
				</div>
			</div>

			<div class="card card-btn" onclick="location.href='/admin/available/' + document.getElementById('enable-task-selector').value + '/1';">
				<div class="card-body text-center">
					Enable task
				</div>
			</div>
		</div>

		<!-- Right Column -->
		<div class="col-md-6">
			<h3>Task Order</h3>

			<p>Drag rows to reorder tasks:</p>

			<table id="reorderable-table" class="table table-striped" data-toggle="table" data-reorderable-rows="true">
				<thead>
					<tr>
						<th scope="col">Task ID</th>
						<th scope="col">Name</th>
						<th scope="col">Filepath</th>
						<th scope="col">Available</th>
					</tr>
				</thead>
				<tbody>
					{% for task in tasks %}
						<tr>
							<td>{{ task[0] }}</td>
							<td>{{ task[1] }}</td>
							<td>{{ task[2] }}</td>
							<td>{{ task[3] }}</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>

			<div id="confirm-reorder" class="card card-btn" onclick="location.href='/admin/reorder/'">
				<div class="card-body text-center">
					Confirm new task order
				</div>
			</div>
		</div>
	</div>

	<script>
		$(function() {
			$('#reorderable-table').bootstrapTable({
				reorderableRows: true
			});
	
			$('#confirm-reorder').click(function() {
				var newOrder = $('#reorderable-table tbody tr').map(function() {
					return $(this).find('td:first').text();
				}).get().join(';');
	
				window.location.href = '/admin/reorder/' + newOrder;
			});
		});
	</script>

{% endblock content %}
