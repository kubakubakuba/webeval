<VirtualHost *:80>
	ServerName eval.comparch.edu.cvut.cz
	ServerAdmin admin@comparch.edu.cvut.cz

	ErrorLog ${APACHE_LOG_DIR}/webeval-error.log
	CustomLog ${APACHE_LOG_DIR}/webeval-access.log combined

	Header always set X-Content-Type-Options "nosniff"
	Header always set X-Frame-Options "SAMEORIGIN"
	Header always set X-XSS-Protection "1; mode=block"
	Header always set Referrer-Policy "strict-origin-when-cross-origin"

	ProxyPreserveHost On
	ProxyTimeout 300

	Alias /wiki PROJECT_ROOT/docs/.vitepress/dist
	<Directory PROJECT_ROOT/docs/.vitepress/dist>
		Options -Indexes +FollowSymLinks
		AllowOverride None
		Require all granted

		RewriteEngine On
		RewriteBase /wiki/
		RewriteCond %{REQUEST_FILENAME} !-f
		RewriteCond %{REQUEST_FILENAME} !-d
		RewriteRule . /wiki/index.html [L]

		<FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
			Header set Cache-Control "public, max-age=31536000, immutable"
		</FilesMatch>

		<FilesMatch "\.html$">
			Header set Cache-Control "no-cache, must-revalidate"
		</FilesMatch>
	</Directory>

	ProxyPass /wiki !
	ProxyPass / http://127.0.0.1:8000/
	ProxyPassReverse / http://127.0.0.1:8000/

	RequestHeader set X-Forwarded-Proto "http"
	RequestHeader set X-Forwarded-Port "80"
</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet